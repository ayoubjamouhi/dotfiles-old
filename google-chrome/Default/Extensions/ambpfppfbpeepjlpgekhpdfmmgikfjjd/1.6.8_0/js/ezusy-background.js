var currencySymbol={AED:"د.إ",AFN:"Af",ALL:"Lek",AMD:"",ANG:"ƒ",AOA:"Kz",ARS:"$",AUD:"$",AWG:"ƒ",AZN:"₼",BAM:"KM",BBD:"$",BDT:"৳",BGN:"лв",BHD:".د.ب",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTN:"Nu.",BWP:"P",BYR:"p.",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLF:"",CLP:"$",CNY:"¥",COP:"$",CRC:"₡",CUP:"⃌",CVE:"$",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"دج",EGP:"E£",ETB:"Br",EUR:"€",FJD:"$",FKP:"£",GBP:"£",GEL:"ლ",GHS:"¢",GIP:"£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"₪",INR:"₹",IQD:"ع.د",IRR:"﷼",ISK:"kr",JEP:"£",JMD:"J$",JOD:"JD",JPY:"¥",KES:"KSh",KGS:"лв",KHR:"៛",KMF:"CF",KPW:"₩",KRW:"₩",KWD:"د.ك",KYD:"$",KZT:"лв",LAK:"₭",LBP:"£",LKR:"₨",LRD:"$",LSL:"L",LTL:"Lt",LVL:"Ls",LYD:"ل.د",MAD:"د.م.",MDL:"L",MGA:"Ar",MKD:"ден",MMK:"K",MNT:"₮",MOP:"MOP$",MUR:"₨",MVR:".ރ",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"₦",NIO:"C$",NOK:"kr",NPR:"₨",NZD:"$",OMR:"﷼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"₱",PKR:"₨",PLN:"zł",PYG:"Gs",QAR:"﷼",RON:"lei",RSD:"Дин.",RUB:"руб",RWF:"ر.س",SAR:"﷼",SBD:"$",SCR:"₨",SDG:"£",SEK:"kr",SGD:"$",SHP:"£",SLL:"Le",SOS:"S",SRD:"$",STD:"Db",SVC:"$",SYP:"£",SZL:"L",THB:"฿",TJS:"TJS",TMT:"m",TND:"د.ت",TOP:"T$",TRY:"₤",TTD:"$",TWD:"NT$",TZS:"",UAH:"₴",UGX:"USh",USD:"$",UYU:"$U",UZS:"лв",VEF:"Bs",VND:"₫",VUV:"VT",WST:"WS$",XAF:"FCFA",XCD:"$",XDR:"",XOF:"",XPF:"F",YER:"﷼",ZAR:"R",ZMK:"ZK",ZWL:"Z$"};chrome.runtime.onMessage.addListener(function(request,sender){chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){if("add_address"==request.type&&$.ajax({type:"POST",url:"https://ilogisticsaddress.aliexpress.com/ajaxSaveOrUpdateBuyerAddress.htm",data:request.data_send}).done(function(a){a.success?chrome.tabs.query({active:!0,currentWindow:!0},function(b){chrome.tabs.sendMessage(b[0].id,{type:"ajax_address",data:a},function(a){})}):(request.data_send.country="US",request.data_send.province="New York",request.data_send.country="New york",request.data_send.zip="10001",$.ajax({type:"POST",url:"https://ilogisticsaddress.aliexpress.com/ajaxSaveOrUpdateBuyerAddress.htm",data:request.data_send}).done(function(a){chrome.tabs.query({active:!0,currentWindow:!0},function(b){chrome.tabs.sendMessage(b[0].id,{type:"ajax_address",data:a},function(a){})})}))}),"ezusy_search"==request.ajax&&$.ajax({url:request.url,type:"GET",dataType:"html"}).done(function(msg){if(msg.indexOf("https://login.aliexpress.com/?from=sm&return_url=")>-1)return void chrome.tabs.query({index:tabs[0].index},function(a){chrome.tabs.sendMessage(a[0].id,{type:"ezusy_searched",dataSearch:"login"},function(a){})});var data=jQuery(msg),script;data.each(function(a){$(this).text().indexOf("window.runParams")>-1&&(script=$(this).text())}),eval(script);var i=0,total=0,alldata={};window.runParams.items.forEach(function(a){var b={};b.id=a.productId,b.title=a.title,b.price=a.price,b.href=a.productDetailUrl,b.rate=a.starRating,b.scoredot=a.store&&a.store.storeName?a.store.storeName:"",b.scoredothref=a.store&&a.store.storeUrl?a.store.storeUrl:"",b.storename=a.store&&a.store.storeName?a.store.storeName:"",b.image=a.imageUrl,b.volume=a.tradeDesc?a.tradeDesc:"0 Sold",alldata[i]=b,i++}),total=window.runParams.resultCount,chrome.tabs.query({index:tabs[0].index},function(a){chrome.tabs.sendMessage(a[0].id,{type:"ezusy_searched",totalSearch:total,dataSearch:JSON.stringify(alldata)},function(a){})})}),"get_alii_html"==request.ajax&&jQuery.ajax(request.data_send).done(function(msg){var data=$(msg),script;data.filter("script").each(function(){$(this).text().indexOf("window.runParams")>-1&&(script+=$(this).text())}),eval(script);var data_product=window.runParams.data,skuPriceList=data_product.skuModule.skuPriceList;if(void 0!==skuPriceList){var sku=skuPriceList,alii={},options={};if(data_product.skuModule.productSKUPropertyList){var productSKUPropertyList=data_product.skuModule.productSKUPropertyList;productSKUPropertyList.forEach(function(a){var b={},c=a.skuPropertyName;a.skuPropertyValues.forEach(function(a){var c,d="";c=a.propertyValueId,d=a.propertyValueDisplayName,src=a.skuPropertyImagePath,simg=a.skuPropertyImageSummPath,b[c]={title:d,src:src,simg:simg}}),options[c]=b}),$.each(sku,function(a,b){var c=b.skuPropIds.split(",");sku[a].title=[],$.each(c,function(b,c){$.each(options,function(d,e){$.each(e,function(d,e){var f={};d==c&&(f.title=e.title,f.img=e.src,f.simg=e.simg,e.src&&(sku[a].img=e.src),e.simg&&(sku[a].simg=e.simg),sku[a].title[b]=f)})})})})}alii.opts=options,alii.options=sku,alii.title=data_product.titleModule.subject,alii.ali_url=data_product.pageModule.itemDetailUrl,alii.product_url=data_product.pageModule.itemDetailUrl,alii.productId=data_product.actionModule.productId,alii.mainBigPic=data_product.pageModule.imagePath,alii.imageBigViewURL=data_product.imageModule.imagePathList,alii.eid=request.data.settings.id,alii.minPrice=data_product.priceModule.maxAmount.value,alii.maxPrice=data_product.priceModule.minAmount.value,alii.minPriceSale=data_product.priceModule.maxActivityAmount?data_product.priceModule.maxActivityAmount.value:0,alii.maxPriceSale=data_product.priceModule.minActivityAmount?data_product.priceModule.minActivityAmount.value:0,alii.currencyCode=data_product.commonModule.currencyCode,alii.currencySymbol=currencySymbol[alii.currencyCode]+" ",alii.currencyRate="1.0";var desc=data_product.descriptionModule.descriptionUrl,full_des=jQuery.ajax({url:desc,method:"GET",cache:!1,data:{url:desc},dataType:"html"});full_des.done(function(a){var b=$("<div>"+a+"</div>");b.find("link").each(function(){$(this).replaceWith()}),b.find("script").each(function(){$(this).replaceWith()});var c=data_product.specsModule,d="";data_product.specsModule&&c.props&&(d="<p><b>SPECIFICATIONS</b></p><ul>",c.props.forEach(function(a){var b="<li><b>"+a.attrName+":</b> "+a.attrValue+"</li>";d+=b}),d+="</ul>"),alii.content=b.html()+d,alii.description=b.html()+d,importdata(alii,request.data.settings,tabs)})}else $(".ezusy_loading").hide(),$(".ezusy_error").show()}),"split_product"==request.ajax&&importdata(request.data.item,request.data.settings,tabs),"sync_woo"==request.ajax){var list=request.list;console.log(list);var sync_product=function(item){var update={},url="https://www.aliexpress.com/item/product/"+item.product_id+".html";$.ajax(url,{success:function(response,status){var data=$(response),script;data.filter("script").each(function(){$(this).text().indexOf("window.runParams")>-1&&(script+=$(this).text())}),eval(script);var data_product=window.runParams.data,skuPriceList=data_product.skuModule.skuPriceList;if(void 0!==skuPriceList)var sku=skuPriceList;update.product_id=item.product_id,update.id=item.id,update.wid=item.wid,update.title=item.title,update.image=item.mainBigPic,update.data=sku,update.user_id=list.user_id,update.store_id=list.store_id,update.status=status,update.type=item.type,$.ajax({type:"POST",url:"https://l8k29f9z51.execute-api.ap-southeast-1.amazonaws.com/syncManualProductEzusy",data:JSON.stringify(update)}).done(function(a){list.splice(0,1),list.length>0&&test(list[0])})},error:function(a,b){update.id=item.id,update.status=b,$.ajax({type:"POST",url:"https://www.ezusy.com/rest_api/sync-cron.php",data:JSON.stringify(update)}).done(function(a){list.splice(0,1),list.length>0&&test(list[0])})}})};sync_product(list.data)}})});var importdata=function(a,b,c){$.ajax({url:"https://www.ezusy.com/wp-admin/admin-ajax.php?action=save_alii",type:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(a)}).done(function(a){chrome.tabs.query({index:c[0].index},function(c){chrome.tabs.sendMessage(c[0].id,{type:"res_save_alii",data:a,settings:b},function(a){})})})};