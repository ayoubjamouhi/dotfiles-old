function setShipping(){setTimeout(function(){chrome.storage.local.get("shipping",function(a){if(!a.shipping.country)return!0;var b="css_"+a.shipping.country.toLowerCase();if("GB"==a.shipping.country&&(b="css_uk"),$(".country-selector-form .link-fake-selector .css_flag").hasClass(b))return!0;$(".country-selector-form .list-container a").length>0?$(".country-selector-form .list-container a").each(function(){$(".css_flag",this).hasClass(b)&&this.click()}):setShipping()})},1e3)}function checkout(){var a=document.querySelector('form[attr="buy-now-form"]').action;a&&(chrome.storage.local.set({cart_step:!1,check_out:!0}),window.open(a,"_self",!1))}chrome.storage.local.get("cart_step",function(a){if(a.cart_step){setShipping();var b=a,c=[],d=!1;$(".product-info-detail").each(function(){var b={};b.title=$(this).find(".lnk-product-name").text(),void 0!==$(this).find(".product-pic-image").attr("src")?b.img=$(this).find(".product-pic-image").attr("src"):b.img=$(this).find(".product-pic-image").attr("data-src"),b.id=$(this).find(".hid-product-id").val(),c.push(b),$(this).parent().addClass("ezusy-item-"+b.id),-1===$(this).parent().html().indexOf(a.cart_step.default_shipping)?b.shipping=!1:b.shipping=!0}),chrome.storage.local.set({ezusy_products:c},function(){chrome.storage.local.get("ezusy_products",function(a){var c='<div class="ezusy-box-notice">';c+='<h3 class="ezusy-box-header">Fulfil Orders Automatically</h3>',c+='<h3 class="ezusy-box-notice-head  ezusy-finished">1. Add to cart</h3>',c+='<h3 class="ezusy-box-notice-head  ezusy-finished">2. Delete address</h3>',c+='<h3 class="ezusy-box-notice-head ezusy-current">3.Select shipping method</h3>',$.each(a.ezusy_products,function(a,e){c+='<div class="ezusy-box-notice-item">',c+='<div class="ezusy-box-notice-image"><img src="'+e.img+'" /></div>',c+='<div class="ezusy-box-notice-title">',c+="<strong>"+e.title.substring(0,20)+"...</strong>",e.shipping?$(".ezusy-item-"+e.id+" .shipping-radio input").val()!=b.cart_step.default_shipping?c+="<p>Selecting shipping</p>":c+='<p class="ezusy-finished">Selected</p>':(b.cart_step.default_shipping?c+='<p style="color:red;">'+b.cart_step.default_shipping+" shipping method isn't available for this product.</p>":c+='<p style="color:red;">You don\'t select default shipping in Ezusy settings > Suppliers</p>',d=!0),c+="</div>",c+="</div>"}),c+=d?'<p class="ezusy-action-section"><a class="next-step" href="javascript:void(0);">Next step >></a></p>':"Redirect to next step in 3 second...",c+='<h3 class="ezusy-box-notice-head">4. Checkout</h3>',c+='<h3 class="ezusy-box-notice-head">5. Confirm & Pay</h3>',c+="</div>",$("body").append(c)})}),$(".product-shipping").each(function(){var b=$(this).find("form");b.html().indexOf(a.cart_step.default_shipping)>-1&&b.find("input").each(function(){$(this).val()==a.cart_step.default_shipping&&void 0===$(this).attr("checked")&&($(this).attr("checked",!0),b.find(".btn-ok").trigger("click"))})}),setTimeout(function(){d||checkout()},3e3)}}),$("body").on("click",".next-step",function(){checkout()});